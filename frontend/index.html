<!-- <!DOCTYPE html>
<html>
<head>
    <title>Deepfake Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #0f172a, #020617);
            color: white;
        }

        .container {
            padding: 40px;
            max-width: 1300px;
            margin: auto;
        }

        h1 {
            font-size: 38px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 25px;
        }

        input[type="file"] {
            margin: 15px 0;
        }

        button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 10px 18px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .result-card img {
            width: 100%;
            border-radius: 10px;
        }

        .fake { color: #f87171; }
        .real { color: #4ade80; }

        .history-item {
            background: rgba(255,255,255,0.03);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
<div class="container">
    <h1>ðŸ§  Deepfake Detection Dashboard</h1>

    <div class="grid">
        <div class="card">
            <h2>Upload Media</h2>
            <input type="file" id="files" multiple />
            <br>
            <button onclick="analyze()">Analyze Media</button>
            <div class="results" id="results"></div>
        </div>

        <div class="card">
            <h2>Analysis History</h2>
            <div id="history"></div>
        </div>
    </div>
</div>

<script>
const API = window.location.origin;

async function analyze() {
    const files = document.getElementById("files").files;
    if (!files.length) return alert("Select files");

    for (let file of files) {
        const formData = new FormData();
        formData.append("file", file);

        const res = await fetch(`${API}/upload`, {
            method: "POST",
            body: formData
        });

        const data = await res.json();
        renderResult(file, data);
    }
}

function renderResult(file, data) {
    const results = document.getElementById("results");
    const history = document.getElementById("history");

    const reader = new FileReader();
    reader.onload = () => {
        const card = document.createElement("div");
        card.className = "result-card";

        const id = Math.random().toString(36).substring(7);

        card.innerHTML = `
            <img src="${reader.result}">
            <h3 class="${data.prediction === 'FAKE' ? 'fake' : 'real'}">${data.prediction}</h3>
            <p>Confidence: ${(data.confidence * 100).toFixed(1)}%</p>
            <p>Resolution: ${data.metadata.resolution}</p>
            <button onclick="downloadPDF('${file.name}', '${data.prediction}', '${data.metadata.created_at}', '${data.metadata.resolution}')">
                Download PDF Report
            </button>
        `;

        results.prepend(card);

        const hist = document.createElement("div");
        hist.className = "history-item";
        hist.innerText = `${file.name} â†’ ${data.prediction}`;
        history.prepend(hist);
    };

    reader.readAsDataURL(file);
}

function downloadPDF(filename, verdict, created, resolution) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    pdf.setFontSize(18);
    pdf.text("Deepfake Analysis Report", 20, 20);

    pdf.setFontSize(12);
    pdf.text(`File: ${filename}`, 20, 40);
    pdf.text(`Verdict: ${verdict}`, 20, 50);
    pdf.text(`Created: ${created}`, 20, 60);
    pdf.text(`Resolution: ${resolution}`, 20, 70);

    pdf.text("Generated by AI Deepfake Detection System", 20, 90);

    pdf.save(`report_${filename}.pdf`);
}
</script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
<title>Deepfake Detection</title>

<style>
body {
  background: #0f172a;
  color: white;
  font-family: Arial;
  padding: 30px;
}

.container {
  display: flex;
  gap: 30px;
}

.panel {
  flex: 1;
  background: #1e293b;
  padding: 20px;
  border-radius: 15px;
}

button {
  background: #6366f1;
  border: none;
  padding: 10px 20px;
  color: white;
  border-radius: 10px;
  cursor: pointer;
}

.item {
  background: #0f172a;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 10px;
}

img {
  width: 140px;
  border-radius: 10px;
}
</style>
</head>

<body>

<h1>Deepfake Detection Dashboard</h1>

<div class="container">
  <div class="panel">
    <h2>Upload Images</h2>
    <input type="file" id="files" multiple><br><br>
    <button onclick="analyze()">Analyze Media</button>
  </div>

  <div class="panel">
    <h2>History</h2>
    <div id="history"></div><br>
    <button onclick="downloadPDF()">Download PDF Report</button>
  </div>
</div>

<script>
setInterval(loadHistory, 3000);

async function analyze() {
  const files = document.getElementById("files").files;
  if (!files.length) return alert("Select files");

  const form = new FormData();
  for (let f of files) form.append("files", f);

  await fetch("/upload", { method: "POST", body: form });
  loadHistory();
}

async function loadHistory() {
  try {
    const res = await fetch("/history");
    const data = await res.json();

    const div = document.getElementById("history");
    div.innerHTML = "";

    data.slice().reverse().forEach(item => {
      const color = item.verdict === "FAKE" ? "#ff4d4d" : "#4ade80";

      div.innerHTML += `
        <div class="item">
          <img src="${item.image_url}" /><br>
          <b>${item.filename}</b><br>
          Verdict: <span style="color:${color}; font-weight:bold">${item.verdict}</span><br>
          Confidence: ${item.confidence}%<br>
          Resolution: ${item.metadata.resolution}<br>
          <small>${item.metadata.created}</small>
        </div>
      `;
    });

  } catch (err) {
    console.error("History error:", err);
  }
}


function downloadPDF() {
  window.open("/report");
}

loadHistory();
</script>

</body>
</html>
